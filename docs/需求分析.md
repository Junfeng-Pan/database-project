好的，这是一份为您定制的《校园一卡通消费系统需求分析说明书》。根据您的要求，我已将数据流图（DFD）直接绘制为 SVG 格式，方便您查看和使用。

---

# 校园一卡通消费系统需求分析说明书

## 1. 引言

### 1.1 项目背景

某高校为实现校园消费与管理的数字化、便捷化，计划建设“校园一卡通消费系统”。该系统旨在解决传统校园消费中现金流转不便、账务管理混乱等问题，为全校师生提供集身份认证、消费支付、充值查询于一体的综合服务平台，同时为学校管理部门提供准确的账务数据支持 。

### 1.2 系统目标

建立一个安全、稳定、高效的数据库系统，支撑校园内食堂、超市、书店等各类消费场景。系统需满足用户办卡、充值、消费、查询以及商户管理等核心需求，并记录每一笔交易明细以供对账 。

---

## 2. 系统功能需求

根据《数据库系统原理实践小组大作业》文档，系统主要包含以下功能模块：

1. **用户管理**：
* 录入与维护用户（学生/教职工）基本信息（姓名、身份证号、联系方式、登录密码等）。


* 支持用户登录系统。


2. **一卡通管理**：
* 
**办卡**：一个用户只能办理一张主卡，生成唯一卡号，记录办卡时间 。


* 
**状态管理**：支持卡片的挂失、注销与补办，卡片状态包括“正常”、“挂失”、“注销” 。


* **余额管理**：实时记录卡片余额。


3. **商户管理**：
* 维护商户基本信息（编号、名称、类型、地址、联系人）。
* 设置商户营业状态（营业/停业）。




4. **交易处理**：
* 
**充值**：支持通过线下或线上渠道充值，记录充值金额、方式及时间 。


* 
**消费**：用户在指定商户消费时，系统验证余额并进行扣款，记录消费明细（含消费商户、金额、时间）。





---

## 3. 数据流图 (Data Flow Diagram, DFD)

### 3.1 顶层数据流图 (0层 DFD)

顶层图展示了系统与外部实体（用户、商户、管理员）之间的宏观交互。

```svg
<svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
  <rect x="50" y="150" width="100" height="60" fill="#e1f5fe" stroke="#01579b" stroke-width="2"/>
  <text x="100" y="185" font-family="Arial" font-size="14" text-anchor="middle" fill="#000">用户</text>

  <rect x="650" y="50" width="100" height="60" fill="#e1f5fe" stroke="#01579b" stroke-width="2"/>
  <text x="700" y="85" font-family="Arial" font-size="14" text-anchor="middle" fill="#000">管理员</text>

  <rect x="650" y="250" width="100" height="60" fill="#e1f5fe" stroke="#01579b" stroke-width="2"/>
  <text x="700" y="285" font-family="Arial" font-size="14" text-anchor="middle" fill="#000">商户</text>

  <circle cx="400" cy="180" r="70" fill="#fff9c4" stroke="#fbc02d" stroke-width="2"/>
  <text x="400" y="175" font-family="Arial" font-size="14" text-anchor="middle" fill="#000">校园一卡通</text>
  <text x="400" y="195" font-family="Arial" font-size="14" text-anchor="middle" fill="#000">消费系统</text>

  <path d="M150 160 L330 160" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="240" y="155" font-family="Arial" font-size="12" text-anchor="middle">用户信息/充值/消费请求</text>

  <path d="M330 200 L150 200" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="240" y="215" font-family="Arial" font-size="12" text-anchor="middle">交易回执/查询结果</text>

  <path d="M650 80 L450 130" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="580" y="100" font-family="Arial" font-size="12" text-anchor="middle">办卡/挂失/注销操作</text>

  <path d="M650 270 L460 220" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="580" y="260" font-family="Arial" font-size="12" text-anchor="middle">商户信息/营业状态</text>

  <path d="M460 200 L650 250" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="580" y="220" font-family="Arial" font-size="12" text-anchor="middle">结算报表</text>

  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>
</svg>

```

### 3.2 第1层数据流图 (1层 DFD)

1层图将系统处理过程细化为三个主要部分：**用户与卡片管理**、**交易处理**、**商户管理**。

```svg
<svg width="900" height="550" xmlns="http://www.w3.org/2000/svg">
  <rect x="30" y="200" width="80" height="50" fill="#e1f5fe" stroke="#01579b" stroke-width="2"/>
  <text x="70" y="230" font-family="Arial" font-size="12" text-anchor="middle">用户</text>

  <rect x="790" y="200" width="80" height="50" fill="#e1f5fe" stroke="#01579b" stroke-width="2"/>
  <text x="830" y="230" font-family="Arial" font-size="12" text-anchor="middle">商户</text>

  <rect x="250" y="50" width="120" height="60" rx="10" ry="10" fill="#fff9c4" stroke="#fbc02d" stroke-width="2"/>
  <text x="310" y="85" font-family="Arial" font-size="12" text-anchor="middle">P1.用户与卡片管理</text>

  <rect x="250" y="250" width="120" height="60" rx="10" ry="10" fill="#fff9c4" stroke="#fbc02d" stroke-width="2"/>
  <text x="310" y="285" font-family="Arial" font-size="12" text-anchor="middle">P2.交易处理</text>
  
  <rect x="550" y="250" width="120" height="60" rx="10" ry="10" fill="#fff9c4" stroke="#fbc02d" stroke-width="2"/>
  <text x="610" y="285" font-family="Arial" font-size="12" text-anchor="middle">P3.商户管理</text>

  <path d="M250 450 L370 450 M250 450 L250 480 M250 480 L370 480" fill="none" stroke="#333" stroke-width="2"/>
  <text x="310" y="470" font-family="Arial" font-size="12" text-anchor="middle">D1.用户信息表</text>

  <path d="M400 450 L520 450 M400 450 L400 480 M400 480 L520 480" fill="none" stroke="#333" stroke-width="2"/>
  <text x="460" y="470" font-family="Arial" font-size="12" text-anchor="middle">D2.一卡通表</text>

  <path d="M550 450 L670 450 M550 450 L550 480 M550 480 L670 480" fill="none" stroke="#333" stroke-width="2"/>
  <text x="610" y="470" font-family="Arial" font-size="12" text-anchor="middle">D3.交易记录表</text>

  <path d="M700 450 L820 450 M700 450 L700 480 M700 480 L820 480" fill="none" stroke="#333" stroke-width="2"/>
  <text x="760" y="470" font-family="Arial" font-size="12" text-anchor="middle">D4.商户信息表</text>

  <path d="M70 200 L70 80 L250 80" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="160" y="70" font-family="Arial" font-size="10" text-anchor="middle">办卡/挂失信息</text>
  
  <path d="M110 225 L250 280" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="180" y="245" font-family="Arial" font-size="10" text-anchor="middle">充值/消费请求</text>

  <path d="M830 200 L830 150 L610 150 L610 250" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="720" y="140" font-family="Arial" font-size="10" text-anchor="middle">注册/状态变更</text>

  <path d="M310 310 L310 450" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="290" y="380" font-family="Arial" font-size="10" text-anchor="end">更新余额</text>
  
  <path d="M340 310 L580 450" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="470" y="380" font-family="Arial" font-size="10" text-anchor="middle">写入消费/充值记录</text>

  <path d="M310 110 L310 450" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/> 
  <text x="320" y="150" font-family="Arial" font-size="10" text-anchor="start">写入/更新用户信息</text>
  
  <path d="M370 80 L460 80 L460 450" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="470" y="150" font-family="Arial" font-size="10" text-anchor="start">发卡/更新状态</text>

  <path d="M640 310 L760 450" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="720" y="380" font-family="Arial" font-size="10" text-anchor="middle">写入商户信息</text>

  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>
</svg>

```

---

## 4. 数据字典 (Data Dictionary)

### 4.1 数据项定义

根据系统关系说明提取的核心数据字段：

| 数据项名 | 别名 | 类型 | 长度 | 说明 |
| --- | --- | --- | --- | --- |
| 用户ID | User_ID | INT | 10 | 系统自动生成的唯一标识 |
| 姓名 | Name | VARCHAR | 20 | 用户真实姓名 |
| 身份证号 | Identity_No | CHAR | 18 | 教职工或学生的证件号 

 |
| 登录密码 | Password | VARCHAR | 32 | 用户登录系统的凭证 |
| 卡号 | Card_No | CHAR | 16 | 16位唯一卡片编号 |
| 卡片状态 | Card_Status | CHAR | 1 | 0:正常, 1:挂失, 2:注销 

 |
| 余额 | Balance | DECIMAL | 10,2 | 卡内剩余金额，单位：元 |
| 商户编号 | Merchant_ID | INT | 10 | 商户的唯一标识 |
| 交易类型 | Trans_Type | CHAR | 1 | 1:充值, 2:消费 |

### 4.2 数据结构定义

* **用户信息** = 用户ID + 姓名 + 身份证号 + 联系方式 + 电子邮箱 + 登录密码
* 
**卡片信息** = 卡号 + 用户ID + 办卡时间 + 当前状态 + 余额 


* 
**商户信息** = 商户编号 + 商户名称 + 商户类型 + 地址 + 联系人 + 营业状态 


* 
**交易记录** = 记录流水号 + 卡号 + (商户编号) + 交易金额 + 交易时间 + 交易后余额 



### 4.3 数据存储定义

| 数据存储名 | 说明 | 输入数据流 | 输出数据流 | 组成 |
| --- | --- | --- | --- | --- |
| **D1 用户表** | 存储所有持有者的基本档案 | 录入用户 | 查询用户 | 用户ID, 姓名, 身份证号... |
| **D2 一卡通表** | 存储卡片的核心状态与余额 | 发卡/充值/消费 | 余额查询/状态校验 | 卡号, 用户ID, 余额, 状态... |
| **D3 消费记录表** | 存储所有消费历史明细 | 消费操作 | 账单查询 | 流水号, 卡号, 商户ID, 金额, 时间 

 |
| **D4 充值记录表** | 存储所有充值历史明细 | 充值操作 | 账单查询 | 流水号, 卡号, 充值方式, 金额, 时间 

 |
| **D5 商户表** | 存储校内商户信息 | 商户注册/变更 | 商户查询 | 商户编号, 名称, 状态... |
